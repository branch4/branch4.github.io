---
layout: post
title: "Slackware on KVM"
date: 2012-03-10T09:07:00-08:00
comments: true
published: false
categories:
 - linux
 - Virtualization
---

こんにちは。KVM でSlackware動かしてみようかなー、と思った[@xengineer01](https://twitter.com/xengineer01)です。  

## 概要
特に目新しいことはなく、タイトル通りですわ。  
まずは、Google様に、"slackware"と聞いてみて、[本家サイト](http://www.slackware.com)へ。  
で、どっかのミラーからslackware64のisoを拝借して、md5のcheckだけしとく。  

```
% md5sum -c slackware64-14.1-xxx.iso
% cat slackwar64-14.1-xxx.md5
```

僕が15年くらい前にはじめてLinuxインストールしたのがSlackware3.2くらいの頃だったので、  
majorバージョンでいうと11あがってるのか。でもなんか途中で、沢山バージョン飛ばしてた気が。  

Version | Releasedate     | End-of-life date | Kernel version
:-----: | :---------:     | :--------------: | :------------:
1.00    | 17 July 1993    |         ??       | 0.99.11 Alpha
1.1     | 5 November 1993 |         ??       | 0.99.13
2.0     |   2 July 1994   |          ??      | 1.0.9
2.1     | 31 October 1994 |  ??              | 1.1.59
2.2     | 30 March 1995   | ??               | 1.2.1
2.3     | 24 May 1995     | ??               | 1.2.8
3.0     |30 November 1995 | ??               | 1.2.13
3.1     |  3 June 1996    | ??               | 2.0.0
3.2     |17 February 1997 | ??               | 2.0.29
3.3     | 11 June 1997    | ??               | 2.0.30
3.4     | 14 October 1997 | ??               | 2.0.30
3.5     |  9 June 1998    | ??               | 2.0.34
3.6     | 28 October 1998 | ??               | 2.0.35
3.9     | 10 May 1999     | ??               | 2.0.37pre10
4.0     | 17 May 1999     | ??               | 2.2.6
7.0     | 25 October 1999 | ??               | 2.2.13
7.1     | 22 June 2000    | ??               | 2.2.16
8.0     |  1 July 2001    | ??               | 2.2.19
8.1     | 18 June 2002    | 1 August 2012    | 2.4.18
9.0     | 19 March 2003   | 1 August 2012    | 2.4.20
9.1     |26 September 2003| 1 August 2012    | 2.4.22
10.0    | 23 June 2004    | 1 August 2012    | 2.4.26
10.1    |  2 February 2005| 1 August 2012    | 2.4.29
10.2    |14 September 2005| 1 August 2012    | 2.4.31
11.0    |  2 October 2006 |1 August 2012     | 2.4.33.3
12.0    |  1 July 2007    |1 August 2012     | 2.6.21.5
12.1    |  2 May 2008     |9 December 2013   | 2.6.24.5
12.2    |10 December 2008 |9 December 2013   | 2.6.27.7
13.0    | 26 August 2009  | ??               | 2.6.29.6
13.1    | 24 May 2010     | ??               | 2.6.33.4
13.37   | 27 April 2011   | ??               | 2.6.37.6
14.0    |28 September 2012| ??               | 3.2.29
14.1    | 4 November 2013 | ??               | 3.10.17

おお、4.0 -> 7.0で飛んでるね！この間、3.5と4.0は使った記憶があるけど、  
あとはインストールすらしていない・・・  

なにはともあれインストール。  
[ここ](http://www.linuxquestions.org/questions/slackware-14/slackware64-current-kvm-guest-boot-issue-871981/)を参考に。  


1 CPUが仮想化支援対応してるかの確認をする  
```
$ grep -E 'vmx|svm' /proc/cpuinfo  
```

vmx : Intel VT support
svm : AMD-V support  

[Intel VT by Intel](http://www.intel.co.jp/content/www/jp/ja/virtualization/virtualization-technology/hardware-assist-virtualization-technology.html)
[Intel VT wiki](http://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AB_%E3%83%90%E3%83%BC%E3%83%81%E3%83%A3%E3%83%A9%E3%82%A4%E3%82%BC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%BB%E3%83%86%E3%82%AF%E3%83%8E%E3%83%AD%E3%82%B8%E3%83%BC) 
[Intel VT by @IT](http://www.atmarkit.co.jp/fsys/kaisetsu/085intelvt/intelvt.html)

[Intel VT & AMD-V by gihyo](http://gihyo.jp/dev/serial/01/vm_work/0005)

[AMD-V by AMD](http://www.amd.com/ja-jp/solutions/servers/virtualization)
[AMD-V by It-pro](http://itpro.nikkeibp.co.jp/article/COLUMN/20061013/250707/)

対応してないと、、、遅いっす。  
CeleronとかAtomじゃなければ最近のCPUで対応してないものは少ないと思うけど。  
そしてぐぐってみて思ったけど、AMD-Vのほうが情報が凄く少ない気がする・・・  

VT技術サポートしなかったら、インストールできません！というわけじゃないけど、  
すこぶる重いので、環境見直してからのほうがよいと思います。  

2 install kvm and bridge-utils 
```
# apt-get install kvm bridge-utils  
```
3 Add user (that executes kvm) to group kvm 
```
# adduser <user> kvm  
```
4 prepare images 
```
$ kvm-img create -f qcow <somename>.img 10G  
```
5 prepare guest OS images or CDs  

I used ISO file.  

```
# mount -t iso9660 -o loop <isofile> <mount point>  
```
6 execute kvm 
```
$ kvm -drive file=/usr/local/kvm_images/slak01.img,if=virtio,boot=on -cdrom /usr/local/os_images/slackware64-13.37-install-dvd.iso -boot d -m 512 -monitor stdio  
```
Then, you'll be seeing Slackware installer boot.  
Now, never forget to use virtio.  
You need this to install Slackware.   

7 install Slackware 
  You do this, Just as you install Slack on physical server, 
  except that you'll fail to install LILO.  
  * never choose btrfs as a filesystem for /boot, lilo don't like it  
8 exit setup(we're gonna install LILO from here)  
9 mount devices/sys/proc -> chroot 
```
# mount -obind /dev /mnt/dev  
# mount -obind /sys /mnt/sys 
# mount -t proc proc /proc /mnt/proc chroot /mnt  
```
10 make initrd  
  Edit mkinitrd.conf 

```
# cd /etc/ 
# cp mkinitrd.conf.sample mkinitrd.conf 
# vi mkinitrd.conf  
```
  Edit following lines: 

```
MODULE_LIST="ext4:virtio_blk:virtio_pci" 
ROOTFS="ext4" 
ROOTDEV="/dev/vda3"  
```

  Get a command line for making initrd.  

```
# /usr/share/mkinitrd/mkinitrd_command_generator.sh -r 
# &gt;execute above command's output here! &lt;  
```
11. edit lilo.conf 
```
# vi /etc/lilo.conf  
```

  Add following line after boot = /dev/vda 

```
disk = /dev/vda bios=0x80 max-partitions=7  
```
  Add following line after image = /boot/vmlinuz 
```
initrd = /boot/initrd.gz  
```
  Comment out root = /dev/vda3.   

12. install LILO 
```
# lilo  
```
13. reboot 
```
# reboot  
```
14. pray it to boot up  

That's all for today.  
That did it for me, I think.  
